title: Epic-Black-Friday-Deals æ•ˆæœçš„å‰ç«¯æŠ€æœ¯å®ç°
url: epic-black-friday
created: 2015-12-15
updated: 2016-01-28
id: 5
tags:
  - front-end
  - effect
---
# ä»‹ç»

è¿™æ˜¯ä¸€ä¸ªé€šè¿‡ web æŠ€æœ¯å®ç°çš„æ•ˆæœæ¼”ç¤º demo ã€‚

åŸè®¾è®¡é“¾æ¥ï¼š [Epic-Black-Friday-Deals](https://dribbble.com/shots/2372734-Epic-Black-Friday-Deals)

åŸæ•ˆæœå›¾ï¼š

<img width="400px" height="300px" src="https://d13yacurqjgara.cloudfront.net/users/107759/screenshots/2372734/ink2.gif" alt="Ink2">

Demo é“¾æ¥ï¼š https://chemzqm.github.io/dribbble-effects/friday.html

æ³¨ï¼šä½¿ç”¨ safari ä¿å­˜åˆ°æ¡Œé¢æµè§ˆæ•ˆæœæ›´ä½³ã€‚

æ•´ä¸ªæ•ˆæœåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†å®ç°ï¼Œä¸ŠåŠéƒ¨åˆ†é€šè¿‡ canvas ä¸æ–­ç»˜åˆ¶å®ç°ï¼Œä¸‹åŠéƒ¨åˆ†ä½¿ç”¨äº† css çš„ transform å’Œ transition æ¥å®ç°ã€‚ ä¸‹é¢æ˜¯è¯¦ç»†ä»‹ç»ã€‚

## åŸºäº canvas å®ç°çš„ä¸ŠåŠéƒ¨åˆ†åŠ¨ç”»

### å…³äºcanvas

canvas æ˜¯ä½¿ç”¨ javascript è¿›è¡Œç»˜å›¾çš„åŸºæœ¬ API, å®ƒæœ¬èº«åªæä¾›äº†åŸºç¡€çš„ç”»å›¾ API ï¼ˆä¾‹å¦‚ç›´çº¿ã€å¼§çº¿ã€æ›²çº¿ã€çŸ©å½¢ã€å¡«å……ç­‰ï¼‰ï¼Œé€šè¿‡å­¦ä¹ [MDNæä¾›çš„æ•™ç¨‹](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial), ä¸€ä¸ªå…·å¤‡ javascript åŸºæœ¬çŸ¥è¯†çš„å¼€å‘è€…å¯ä»¥å¾ˆå¿«æŒæ¡ã€‚

canvas å¹¶ä¸æä¾›åŠ¨ç”»ï¼Œäº‹ä»¶ç­‰æ›´é«˜å±‚çš„ APIï¼Œæ‰€ä»¥éœ€è¦ç›¸åº”åŠŸèƒ½éƒ½éœ€è¦è‡ªè¡Œè®¡ç®—ï¼Œæˆ–è€…å€ŸåŠ©å…¶å®ƒåº“æ¥å®ç°ã€‚

å°½ç®¡æŠ½è±¡æ€§å¾ˆä½ï¼ˆæˆ–è€…è¯´éå¸¸åº•å±‚ï¼‰ä½†æ˜¯ç›¸åº”çš„å¥½å¤„æ˜¯å¯å¡‘æ€§æ¯”è¾ƒå¥½ï¼Œå› ä¸ºå¼€å‘è€…å¯ä»¥ç²¾ç¡®çš„æ§åˆ¶æ¯ä¸€ä¸ªç»†èŠ‚å¦‚ä½•å®Œæˆã€‚

### canvas åŠ¨ç”»å®ç°

canvas æœ¬èº«æ˜¯é™æ€çš„ï¼Œå¹¶ä¸æä¾›åŠ¨ç”»ï¼Œæ‰€ä»¥æˆ‘ä»¬å€ŸåŠ© API [requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)ï¼Œ é€šè¿‡é‡å¤çš„è°ƒç”¨è¿™ä¸ª API ï¼Œ ä¸æ–­çš„æ¸…ç©ºç”»å¸ƒï¼Œå¹¶å€ŸåŠ©å…¶è¿”å›çš„ timestamp æ—¶é—´æˆ³è®¡ç®—ç»˜åˆ¶æ‰€éœ€çš„å‚æ•°å€¼ï¼Œå°±å¯ä»¥å®ç°åŠ¨ç”»æ•ˆæœäº†ï¼Œ ä»£ç ç¤ºä¾‹ï¼š

``` js
var raf = window.requestAnimationFrame
var start
function animate(timestamp) {
	if(!start) start = timestamp
	//é€šè¿‡æŒç»­æ—¶é—´ä¸åŒé‡ç»˜
	drawImage(timestamp - start)
	raf(animate)
}
raf(animate)
```

å½“ç„¶ä½ ä¹Ÿèƒ½ç”¨ setInterval è¿™æ ·çš„ API å®ç°ï¼Œä½†æ˜¯è¿™ä¹ˆåšæ€§èƒ½å¤ªå·®ï¼Œæ¯”å¦‚å½“å‰é¡µé¢éšè—çš„æ—¶å€™ requestAnimationFrame æ˜¯ä¸ä¼šè§¦å‘è°ƒç”¨çš„ï¼Œè¿™æ ·å°±èŠ‚çœäº†å®¢æˆ·ç«¯çš„èµ„æºã€‚

### å®ç°ç¼“åŠ¨æ•ˆæœ

ç¼“åŠ¨æ•ˆæœå¯ä»¥è®©ä½ çš„åŠ¨ç”»æ›´æŸ”å’Œè‡ªç„¶ï¼Œ[easings.net](http://easings.net/zh-cn)ä¸Šå¯ä»¥çœ‹åˆ°å·²ç»å‘½åçš„ç¼“åŠ¨å‡½æ•°ï¼Œå…¶å®è´¨å°±æ˜¯æŠŠä¸€ä¸ª 0 åˆ° 1 ä¹‹é—´çš„å€¼è¿›è¡Œè½¬åŒ–ã€‚ [component/ease](https://github.com/component/ease/blob/master/index.js) æ˜¯ä¸€ä¸ªå®ç°äº†ç¼“åŠ¨å‡½æ•°çš„ javascript åº“ï¼Œæˆ‘ä»¬æ‹¿å®ƒçš„ä¸€ä¸ªå‡½æ•° `inQuad` ä¸¾ä¾‹ï¼š

``` js
function inQuad(n){
  return n * n;
}
var duration = 600 //åŠ¨ç”»æŒç»­ 600 ms
var raf = window.requestAnimationFrame
var start
function animate(timestamp) {
	if(!start) start = timestamp
	var percent = (timestamp - start)/duration
	// è½¬åŒ–ä¸ºç¼“åŠ¨åçš„å€¼
	percent = inQuad(percent)
	drawImage(percent)
	raf(animate)
}
raf(animate)
```
è¿™æ ·æˆ‘ä»¬çš„ `drawImage`æ¥æ”¶åˆ°çš„å°±æ˜¯ç¼“åŠ¨åçš„ç™¾åˆ†æ¯”äº†ã€‚

å°½ç®¡ `drawImage` æ¥æ”¶åˆ°äº†ç™¾åˆ†æ¯”ï¼Œä½†æ˜¯å…·ä½“çš„å€¼å¾ˆæ˜¯éœ€è¦è‡ªå·±è®¡ç®—ï¼Œå¦‚æœä½ æƒ³çœäº‹å¯ä»¥å€ŸåŠ© [component/tween](https://github.com/component/tween) ä¹‹ç±»çš„åº“æ¥å¸®ä½ è®¡ç®—å±æ€§å€¼ï¼Œäº‹å®ä¸Šåé¢è¦è®²åˆ°çš„æ—¥æœŸé€‰æ‹©çš„æ»‘åŠ¨æ•ˆæœå°±æ˜¯å€ŸåŠ© tween æ¥å®ç°çš„.

## keyframe(å…³é”®å¸§) çš„å®ç°

keyframeï¼ˆå…³é”®å¸§ï¼‰æ˜¯ä¸€ç§å¯¹åŠ¨ç”»æ§åˆ¶éå¸¸æœ‰ç”¨çš„æŠ½è±¡ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªç”»ä¸€ä¸ªåœˆçš„èµ·å§‹å’Œç»ˆæ­¢å°±å„è‡ªå¯¹åº”ä¸€ä¸ª keyframeï¼Œcss animation å°±æ˜¯é€šè¿‡æ§åˆ¶ keyframe æ¥å®ç°åŠ¨ç”»çš„ APIã€‚ canvas ä¹Ÿæœ‰ç±»ä¼¼çš„åº“æ¥å®ç° keyframeï¼Œä¾‹å¦‚ [rekapi](https://github.com/jeremyckahn/rekapi)ã€‚ å› ä¸ºè¿™æ¬¡çš„åŠ¨ç”»å¹¶ä¸éœ€è¦ playback æ”¯æŒï¼ˆæˆ–è€…è¯´æˆ‘æ¯”è¾ƒæ‡’ï¼‰ï¼Œæ‰€ä»¥è¿™æ¬¡åªæ˜¯ç®€å•çš„é€šè¿‡çŠ¶æ€æ¥å®ç°äº†ä¸åŒæ•ˆæœçš„åˆ‡æ¢ï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼š

``` js
function View() {
	//è´Ÿè´£åœ†åœˆçš„ç»˜åˆ¶
	this.circle = new Circle(this)
	//è´Ÿè´£ä¸­é—´å›¾æ ‡ç»˜åˆ¶
	this.icon = new Icon(this)
	//è´Ÿè´£æ—¶é—´æ–‡æœ¬çš„ç»˜åˆ¶
	this.time = new Time(this)
	this.stat = 'stopped'
}
//å±•å¼€çŠ¶æ€
View.prototype.pend = function() {
	this.stat = 'pending'
}
//ä¸­é—´å¯¹å‹¾æ•ˆæœ
View.prototype.check= function() {
	this.stat = 'checking'
}
//é‡ç½®ä¸ºå±•å¼€çŠ¶æ€
View.prototype.reset = function() {
	this.stat = 'reseting'
}
//ä¸»ç»˜åˆ¶å‡½æ•°
View.prototype.draw = function(){
	this.circle.draw()
	this.time.draw()
	this.icon.draw()
}

//æ¯ä¸ªå­æ¨¡å—é€šè¿‡åˆ¤å®š view çš„ stat ç»˜åˆ¶
function Circle(view){
	this.view = view
}
Circle.prototype.draw = function(){
	var stat = this.view.stat
	switch (stat) {
		case 'pending':
			this.pend()
		case 'checking':
			this.check()
		case 'reseting':
			this.reset()
	}
}
// time æ¨¡å—å’Œ icon æ¨¡å—åŒä¸Š
```

è¿™ç§å†™æ³•æ¯”è¾ƒæ–¹ä¾¿çœäº‹ï¼Œä½†æ˜¯æŠ½è±¡æ€§æ¯”è¾ƒå·®ï¼Œå»ºè®®éœ€è¦çµæ´»æ§åˆ¶çš„è¯è¿˜æ˜¯æ‰¾ä¸€ä¸ªé€‚åˆçš„åº“æ¥è¾…åŠ©ã€‚

## åŠ¨ç”»æµç¨‹æ§åˆ¶

å› ä¸ºæ²¡æœ‰å®ç° keyframe ï¼Œæ‰€ä»¥æµç¨‹æ§åˆ¶ï¼ˆä¾‹å¦‚å–æ¶ˆåŠ¨ç”»å’ŒåŠ¨ç”»è¿ç»­ï¼‰ä¹Ÿå¾—è‡ªå·±æ¥å®ç°äº†ã€‚ å¯é€‰çš„åŠæ³•æœ‰ callback å›è°ƒï¼Œäº‹ä»¶ï¼ŒPromiseç­‰ï¼Œè¿™æ¬¡ä½¿ç”¨äº† Promise å®ç°ï¼Œå› ä¸ºä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€æ´ï¼Œè€Œä¸”å¯ä»¥å¾ˆå®¹æ˜“å®ç°å–æ¶ˆæ“ä½œã€‚

é€šè¿‡è®© Promise reject æ¥å–æ¶ˆåŸæ¥åŠ¨ç”»æµç¨‹ï¼š

``` js
View.prototype.cancel = function () {
  this.promise = this.promise || Promise.resolve(null)
  this.canceled = true
  var self = this
  return this.promise.then(function () {
    // å½“å‰ promise å·²ç»æ‰§è¡Œå®Œæ¯•
    self.canceled = false
  }, function () {
    // reject è¡¨æ˜æˆåŠŸç»“æŸ
    self.canceled = false
  })
}

View.prototype.animate = function () {
  var duration = this.duration
  var start
  var self = this
  var promise = this.promise = new Promise(function (resolve, reject) {
    // raf è°ƒç”¨çš„ç»˜åˆ¶ä¸»è¿›ç¨‹
    function step(timestamp) {
      // transform é‡ç½®
      // å› ä¸ºä½¿ç”¨äº† https://github.com/component/autoscale-canvas/blob/master/index.js é€šè¿‡ scale æ”¯æŒ Retinaï¼Œ
      // æ‰€ä»¥è¿™é‡Œä¸èƒ½ç®€å•çš„æŠŠ scale è®¾ä¸º 1
      self.ctx.setTransform(window.devicePixelRatio || 1 ,0 ,0 ,window.devicePixelRatio || 1 ,0, 0);
      // æ¸…ç©ºç”»å¸ƒ
      self.ctx.clearRect(0, 0, self.width, self.height)
      // åœæ­¢åŠ¨ç”»å¹¶ä¸” reject
      if (self.canceled === true) {
        return reject()
      }
      if (!start) start = timestamp
      var d = timestamp - start
      // å›ç€ä¸åŒæ¨¡å—
      self.draw()
      // æˆåŠŸç»“æŸ
      if (d > duration) {
        return resolve()
      }
      raf(step)
    }
    raf(step)
  })
  return promise
}
```

è°ƒç”¨ `view.cancel()` å°±å¯ä»¥å–æ¶ˆåŸæ¥çš„æµç¨‹äº†ã€‚

[viewæ¨¡å—](https://github.com/chemzqm/dribbble-effects/blob/master/lib/friday/index.js) çš„ `cancel` `pend` `reset` å’Œ `check` æ–¹æ³•éƒ½è¿”å›äº† promise å¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬éœ€è¦å¼€å§‹æ–°çš„æµç¨‹å°±å¯ä»¥è¿™æ ·å†™ï¼š

``` js

// å…ˆå–æ¶ˆå½“å‰åŠ¨ç”»
view.cancel()
.then(function () {
  // åªæœ‰å½“å‰æ˜¯ checked å®ŒæˆçŠ¶æ€æ‰èµ° reset æµç¨‹
  if (view.checked) {
    return view.reset().then(function () {
      // æš‚åœä¸€ä¸‹å†å¼€å§‹å±•å¼€
      return view.wait(300)
    })
  }
}).then(function () {
  return view.pend()
}).then(function () {
  return view.check()
}).catch(function () {
  // å› ä¸ºé€šè¿‡ fail æ¥ç»ˆæ­¢åŠ¨ç”»ï¼Œä¸æ•è·ä¼šæŠ¥é”™
  return true
})
```

### å…·ä½“æ•ˆæœå®ç°

* æ¶ˆé€åœ†åœˆçš„æ®‹ä½™å°¾å·´ï¼šé¦–å…ˆæ˜¯è®¾å®šäº†ä¸€ä¸ªåŒºé—´ï¼Œä¾‹å¦‚ï¼š`arr = [1, 2, 2, 1, 1]` è¡¨ç¤ºæœ‰ `arr.length` ä¸ªåŒºé—´ï¼Œæ¯ä¸ªåŒºé—´æœ‰ `arr[i]` ä¸ªå°¾å·´ï¼Œæ¯æ¬¡å˜æ¢åŒºé—´éƒ½é‡æ–°ç”Ÿæˆå°¾å·´ï¼š

``` js
step_len = arr.length
Circle.prototype.pend = function () {
  var ctx = this.ctx
  var percent = this.view.percent
  var step = Math.floor(percent*step_len)
  // step è½¬å˜ï¼Œç”Ÿæˆæ–°çš„ tail
  if (step > this.step) {
    this.createTails()
  }
  this.step = step
  // ç»˜åˆ¶æ¯ä¸€ä¸ªtail
  this.tails.forEach(function (tail) {
    // è®¡ç®— tail çš„ percent
    var p = percent*step_len - step
    // tail æ ¹æ®è‡ªå·± percent (0 ä¸ºåˆå§‹ 1ä¸ºæ¶ˆå¤±)è¿›è¡Œç»˜åˆ¶
    tail.draw(p)
  })
}

Circle.prototype.createTails = function () {
  var n = this.step
  var num = steps[n]
  var tails = []
  for (var i = 0; i < num; i++) {
    var tail = new Tail(this, i)
    tails.push(tail)
  }
  this.tails = tails
}
```

* æ—¶é—´åŠ¨ç”»çš„è®¡ç®—ï¼Œè¿™é‡Œçš„å±•å¼€å’Œé‡ç½®åŠ¨ç”»æ˜¯ä¸åŒçš„ï¼ˆæš‚å¼€æ—¶åˆ†ç§’çš„åŠ¨ç”»è¦è¿œå¿«ä¸æ—¶ï¼Œé‡ç½®æ—¶æ—¶åˆ†ç§’çš„é€Ÿç‡æ˜¯ç›¸åŒçš„ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸èƒ½ç®€å•çš„ playback äº†ï¼Œé‡ç½®æ—¶åªéœ€è¦ `percent*total` å°±èƒ½è®¡ç®—å¯¹åº”çš„ååˆ†ç§’ï¼Œå±•å¼€æ—¶éœ€è¦æ ¹æ®ä¸€å¤©çš„ååˆ†ç§’è¿›è¡Œä¸€ç‚¹è®¡ç®—ï¼š
```
function pad(n) {
  return ('0' + String(n)).slice(-2)
}

function toHMS(n) {
  var h = Math.floor(n/3600)
  var m = Math.floor((n - h*3600)/60)
  var s = Math.floor(n%60)
  return {
    h: pad(h),
    m: pad(m),
    s: pad(s)
  }
}
// 1å¤©çš„ç§’æ•°
var total = 24*60*60
// è·å– hms
toHMS(n)
```

å…¶å®è¿™é‡Œæœ‰ä¸ªå‘ï¼Œå°±æ˜¯å› ä¸ºç§’æ•°å˜åŒ–é£å¿«ï¼Œæœ‰å¯èƒ½ 1/60 ç§’å°±å®Œæˆäº† 0~60 çš„å˜åŒ–, è¿™æ ·å¦‚æœæµè§ˆå™¨æ˜¯ 60hz çš„è¯å°±åªä¼šæ˜¾ç¤ºç›¸å¯¹å›ºå®šçš„ç§’æ•°ï¼Œä¾‹å¦‚ `
5x` (xä¸º0 ~ 9), è§£å†³åŠæ³•å°±æ˜¯è°ƒæ•´ä¸‹åŠ¨ç”»æŒç»­æ—¶é—´ ğŸ˜…

* è®¾ç½®åŠ¨æ€æ–‡æœ¬ã€‚è¿™æ¬¡æœ¬æ¥æ‰“ç®—ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ ProximaNova-Light æ¥æ˜¾ç¤ºæ—¶é—´çš„ï¼Œä½†æ˜¯å‘ç°è¿™ä¸ªå­—ä½“çš„æ•°å­—ä¸æ˜¯ç­‰å®½çš„ï¼Œç»“æœå°±æ˜¯æ˜¾ç¤ºåŠ¨ç”»çš„æ—¶å€™æ•°å­—ä¼šä¸€ç›´æŠ–åŠ¨ï¼Œæ”¹ä¸ºç³»ç»Ÿè‡ªå¸¦å­—ä½“ `sans-serif` `Helvetica` å°±æ²¡æœ‰è¿™ç§é—®é¢˜ã€‚

* å¯¹å‹¾çš„å®ç°ã€‚æœ¬æ¬¡å®ç°æœ€ä¸ºå¤æ‚çš„éƒ¨åˆ†ï¼Œå› ä¸ºæ¶‰åŠè§’åº¦ã€ä½ç½®ã€é•¿åº¦çš„ç²¾ç¡®è®¡ç®—ï¼Œæœ€åä½¿ç”¨äº†é»„é‡‘åˆ†å‰²ï¼Œä¹Ÿå°±æ˜¯å³è¾¹æ¯”å·¦è¾¹ 1.618: 1, ç»“æœæ¯”è¾ƒæ»¡æ„ã€‚ä»£ç å¦‚ä¸‹ï¼š

``` js
Icon.prototype.drawCorrect = function (p, tx) {
  var l = 14
  var tl = 2.618*l
  var len = tl*(outBack(p))
  var ctx = this.ctx
  var x = this.x
  var y = this.y
  // èµ·å§‹ x y
  var sx = x - 10
  var sy = y - 3
  var subtense = Math.min(len, l)
  // ä¸­é—´ç‚¹ x y
  var mx = sx + subtense*Math.cos(45*PI/180)
  var my = sy + subtense*Math.sin(45*PI/180)
  tx = tx != null ? tx : - 8*(1 - outBack(p))
  // åç§»é‡
  ctx.translate(tx, 0)
  ctx.beginPath()
  ctx.moveTo(sx, sy)
  ctx.lineTo(mx, my)
  if (len > l) {
    subtense = len - l
    // ç»ˆæ­¢ x y
    var ex = mx + subtense*Math.cos(50*PI/180)
    var ey = my - subtense*Math.sin(50*PI/180)
    ctx.lineTo(ex, ey)
  }
  ctx.stroke()
  // é‡ç½® transform
  ctx.setTransform(window.devicePixelRatio || 1 ,0 ,0 ,window.devicePixelRatio || 1 ,0, 0);
}

// å‡ºå»ä¸€ç‚¹è¿”å›
function outBack(n){
  var s = 1.70158;
  return --n * n * ((s + 1) * n + s) + 1;
}
```

è¿™é‡Œå‡ ä¸ªç‚¹çš„åæ ‡ä¸ç”¨é‡å¤è®¡ç®—çš„ï¼Œä½†æ˜¯æ¯”è¾ƒå·æ‡’å°±æ²¡æŠ½è±¡å‡ºå»ğŸ™‚

* åˆ›å»ºé®ç½©ã€‚ä¸ºäº†å®ç°ä¸­é—´å›¾æ ‡çš„è¿›å…¥å’Œé€€å‡ºæ•ˆæœï¼Œæˆ‘åœ¨æ¯æ¬¡åŠ¨ç”»çš„æ—¶å€™éƒ½åœ¨ä¸­é—´å›¾æ ‡çš„å·¦è¾¹æˆ–è€…å³è¾¹åˆ›å»ºäº†ä¸€ä¸ªä¸èƒŒæ™¯è‰²ç›¸åŒçš„çŸ©å½¢åŒºåŸŸï¼Œè¿™æ ·å›¾æ ‡å‡ºå»çš„æ—¶å€™å°±ä¼šè¢«é®ç½©ç›–ä½ï¼Œçœ‹ä¸Šå°±å°±å¥½è±¡å›¾æ ‡æ˜¯åœ¨ä¸‹ä¸€å±‚é€€å‡ºçš„ä¸€æ ·ã€‚(å› ä¸ºcanvas å¹¶æ²¡æœ‰ z-index)

## åŸºäº Dom çš„ä¸‹åŠéƒ¨åˆ†æ—¥æœŸé€‰æ‹©æ¨¡å—

### æ—¥æœŸçŠ¶æ€å˜åŒ–æ—¶é¢œè‰²æ¸å˜

åªéœ€è¦ç”¨ css ä¸€ä¸ª transion å°±èƒ½å®ç°ï¼š

``` css
transition: color 0.5s linear;
```

å¯¹åº”çŠ¶æ€åˆ‡æ¢æ—¶æ”¹å˜å…ƒç´ çš„ className å°±å¯ä»¥äº†ï¼Œï¼ˆå°æŠ€å·§: classList APIï¼‰

### æ—¥æœŸåˆ—è¡¨è§¦æ‘¸æ»šåŠ¨å®ç°

é€šè¿‡ä¸æ–­è°ƒæ•´å…ƒç´ çš„ translateX æˆ–è€…æœ‰ translate3d æ—¶è°ƒæ•´ translate3d çš„ x å€¼å®ç°ï¼š

``` js
var s = el.style
if (has3d) {
  s[transform] = 'translate3d(' + x + 'px, 0, 0)'
} else {
  s[transform] = 'translateX(' + x + 'px)'
}
```

è¿™é‡Œç›¸å¯¹å¤æ‚çš„ä¸€æ­¥å°±æ˜¯ touchend æ—¶è®¡ç®—ä¹‹ååŠ¨ç”»çš„æŒç»­æ—¶é—´ã€æœ€ç»ˆä½ç½®å’Œç¼“åŠ¨å‡½æ•°ï¼š

``` js
// å‡é€Ÿåº¦
var deceleration = 0.0004
// å½“å‰æ»‘åŠ¨é€Ÿåº¦
var speed = this.speed
var x = this.x
// é™å®šé€Ÿåº¦
speed = Math.min(speed, 0.6)
var minX = - (this.total - this.count)*width
// ä¼°ç®—ç»ˆç‚¹
var destination = x + ( speed * speed ) / ( 2 * deceleration ) * ( this.distance < 0 ? -1 : 1 )
// ä¼°ç®—æ—¶é—´
var duration = speed / deceleration
var newX
var ease = 'out-cube'
// ç»ˆç‚¹è¶…å‡ºå³è¾¹ç•Œ é‡ç®—ç»ˆç‚¹å’Œç¼“åŠ¨å‡½æ•°
if (destination > 0) {
  newX = 0
  ease = 'out-back'
// ç»ˆç‚¹å°äºå·¦è¾¹ç•Œ é‡ç®—ç»ˆç‚¹å’Œç¼“åŠ¨å‡½æ•°
} else if (destination < minX) {
  newX = minX
  ease = 'out-back'
}
// è¶…å‡ºè¾¹ç•Œçš„è¯é‡ç®—æŒç»­æ—¶é—´
if (typeof newX === 'number') {
  duration = duration*Math.abs((newX - x + 50)/(destination - x))
  //duration = Math.max(200, duration)
  destination = newX
}
// å½“å‰ç‚¹åœ¨è¾¹ç•Œå¤–ï¼Œå›ºå®šæŒç»­æ—¶é—´å’Œç¼“åŠ¨å‡½æ•°
if (x > 0 || x < minX) {
  duration = 500
  ease = 'out-circ'
}
// å›ºå®šç»ˆç‚¹ä¸ºå­å…ƒç´ å®½åº¦çš„æ•´æ•°å€
destination = Math.round(destination/width)*width
return {
  x: destination,
  duration: duration,
  ease: ease
}
```

è®¡ç®—å®ŒæˆåæŠŠç»“æœä¼ é€’ç»™ `tween` å¯¹è±¡å°±å¯ä»¥å¼€å§‹æ»‘åŠ¨äº†ã€‚

### æ—¥æœŸé€‰æ‹©

ç”¨åˆ°äº† [events](https://github.com/component/events) å®ç°äº‹ä»¶ä»£ç†, ä»¥åŠ[tap-event](https://github.com/chemzqm/tap-event)å®ç°æ­£ç¡®çš„ tap äº‹ä»¶ ï¼ˆéƒ½æ˜¯éå¸¸å¸¸ç”¨çš„ç§»åŠ¨ç«¯ç»„ä»¶ï¼‰

``` js
// ç®€å•çš„åˆ¤å®šï¼Œé˜²æ­¢ click å’Œ tap äº‹ä»¶åŒæ—¶è§¦å‘
var hastouch = 'ontouchstart' in window

function Footer() {
  this.events = events(el, this)
  if (hastouch) {
    this.events.bind('touchstart li', 'ontap')
  } else {
    this.events.bind('click li')
  }
}

Footer.prototype.onclick = function (e) {
  var li = e.delegateTarget
  var children = this.el.children
  for (var i = 0, l = children.length; i < l; i++) {
    if (li === children[i]) {
      // é«˜äº®é€‰ä¸­å…ƒç´ 
      li.classList.add('active')
    } else {
      // ç§»é™¤å…¶å®ƒå…ƒç´ é«˜äº®
      li.classList.remove('active')
    }
  }
}

Footer.prototype.ontap = tap(Footer.prototype.onclick)
```

### äº‹ä»¶ä¼ é€’

ä½¿ç”¨çš„ [component/emitter](https://github.com/component/emitter), å®ƒå®ç°äº†éå¸¸ç®€å•çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆè®¢é˜…å‘å¸ƒæ¨¡å¼ï¼‰

``` js
function Footer(el) {
  ...
}

Emitter(el)

Footer.prototype.active = function (index) {
  this.emit('change',  index)
}

function View() {
  var footer = this.footer = new Footer()
  footer.on('change', function(index) {
    // active å˜åŒ–çš„äº‹ä»¶ä»£ç†å‡½æ•°
  })
}
```

è¿™æ ·æˆ‘ä»¬å°±å®ç°äº† `Footer` æ¨¡å—å’Œ `View` æ¨¡å—çš„è§£è€¦åˆ

## Q and A

Q: ä¸ºä»€ä¹ˆæ²¡æœ‰æ³¨é‡Š?

A: å®ç°æ¯”è¾ƒä»“ä¿ƒï¼Œè€Œä¸”ä¹Ÿä¸æ˜¯å®é™…ä½¿ç”¨é¡¹ç›®ï¼Œæ‰€ä»¥æ¯”è¾ƒå·æ‡’ï¼Œå…¶å®æˆ‘çš„å¤§éƒ¨åˆ†é¡¹ç›®éƒ½å¾ˆä¸¥è‚ƒï¼Œä¹Ÿæœ‰æ¯”è¾ƒå®Œæ•´çš„æµ‹è¯•å’Œæ³¨é‡Šã€‚

Q: ä¸ºä»€ä¹ˆ ios ä¸Šä¿å­˜ä¸º app åçŠ¶æ€æ æ˜¯ç™½è‰²ï¼Ÿ

A: å› ä¸ºè¿™æ˜¯ ios9 çš„ bugï¼Œ åŸæœ¬å¯ä»¥é€æ˜çš„ï¼Œ [äº†è§£æ›´å¤š](https://forums.developer.apple.com/thread/9819)

Q: ä¸ºä»€ä¹ˆæ‰‹æœºæ¨ªè¿‡æ¥å°±ä¸èƒ½çœ‹äº†ï¼Ÿ

A: å› ä¸ºç°åœ¨safari è¿˜æ²¡æœ‰å®ç°é”å±çš„ API !


## æœ€å

å®ç° web åŠ¨ç”»è¿˜æœ‰ [css animation](https://developer.mozilla.org/en/docs/Web/CSS/animation), [webgl](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API) [svg smil](https://developer.mozilla.org/en-US/docs/Web/SVG/SVG_animation_with_SMIL) ç­‰æ–¹æ¡ˆï¼Œè¿™æ¬¡å¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œä»¥åæœ‰æœºä¼šå†ä¸ºå¤§å®¶ä»‹ç»ã€‚

æˆ–è®¸æ˜¯å› ä¸º web å­˜åœ¨å¾ˆå¤šçš„æŠ€æœ¯æ–¹æ¡ˆä»¥åŠç›¸åº”ç±»åº“ï¼Œå¯¼è‡´å¾ˆå¤šåš web çš„åŒå­¦è§‰å¾—æç‰¹æ•ˆå¾ˆå¤æ‚ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤, åªè¦ä½ äº†è§£äº†å®ƒä»¬åŸºæœ¬ç‰¹ç‚¹å¹¶æŒæ¡åŸºæœ¬æ–¹æ³•ï¼Œå°±è¶³å¤Ÿåšå‡ºä¸é”™çš„æ•ˆæœäº†ï¼Œå†é™„é€ä¸€ä¸ªæ›´ç®€å•çš„ä¾‹å­ï¼š[canvas loadings](https://chemzqm.github.io/loadings/)

å¸Œæœ›æœ¬æ–‡èƒ½å¸®ä½ åšå‡ºæ›´å¥½çš„ web åŠ¨ç”»æ•ˆæœã€‚

